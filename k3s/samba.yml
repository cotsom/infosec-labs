apiVersion: v1
kind: ConfigMap
metadata:
  name: samba-env
data:
  USER: "user;password"
  SHARE: "bussiness;/bussiness;yes;no;yes"
  SHARE1: "IT;/IT;yes;no;yes"
  SHARE2: "accounting;/accounting;yes;no;yes"
  SHARE3: "stuff;/stuff;yes;no;yes"
  SHARE4: "share;/share;yes;no;yes"

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: samba-flag
data:
  flag.txt: |
    {{ .Flag }}

---
apiVersion: v1
kind: Pod
metadata:
  name: samba
  labels:
    app: samba-{{ .ClientName }}
    client: "{{ .ClientName }}"
spec:
  containers:
    - name: samba
      image: dperson/samba:latest
      ports:
        - containerPort: 139
        - containerPort: 445
      envFrom:
        - configMapRef:
            name: samba-env-{{ .ClientName }}
      volumeMounts:
        - name: samba-flag
          mountPath: /share/
      resources:
          limits:
            memory: 10Mi
            cpu: "0.1"
          requests:
            memory: 10Mi
            cpu: "0.1"
  volumes:
    - name: samba-flag
      configMap:
        name: samba-flag-{{ .ClientName }}
